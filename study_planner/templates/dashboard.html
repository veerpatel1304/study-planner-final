<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner - Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <header>
        <nav>
            <div class="logo">Study Planner</div>
            <div class="nav-links">
                <span>Welcome, {{ user if user else 'Student' }}!</span>
                <a href="{{ url_for('profile') }}" class="btn">My Profile</a>
                <a href="{{ url_for('logout') }}" class="btn">Logout</a>
            </div>
        </nav>
    </header>

    <main class="container">
        <h1>My Dashboard</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% if not db_healthy %}
        <div class="alert alert-warning" style="margin-bottom: 2rem; border-left: 5px solid #f39c12;">
            <h4 style="margin-top: 0;">⚠️ Database Setup Required</h4>
            <p>The AI Agent cannot save your study plans because the <code>tasks</code> table is missing in your
                Supabase project.</p>
            <p style="margin-top: 0.5rem;">To fix this, please run the SQL code from <code>schema.sql</code> in your
                <strong>Supabase SQL Editor</strong>.</p>
        </div>
        {% endif %}

        <div class="dashboard-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>My Study Plans</h3>
                    <a href="{{ url_for('create_plan') }}" class="btn btn-small btn-primary">+ New Plan</a>
                </div>

                {% if plans %}
                <ul class="plan-list">
                    {% for plan in plans %}
                    <li style="border-bottom: 1px solid #eee; padding: 1rem 0;">
                        <strong>{{ plan.title }}</strong>
                        <p style="color: #666; font-size: 0.9rem; margin: 0.2rem 0;">{{ plan.goal }}</p>
                        <small>From {{ plan.start_date }} to {{ plan.end_date }}</small>
                        <div style="margin-top: 0.5rem;">
                            <!-- Placeholder for View/Edit links -->
                            <a href="{{ url_for('view_plan', plan_id=plan.id) }}"
                                style="color: var(--primary-color); font-size: 0.9rem;">View Details</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>You have no active study plans yet.</p>
                <div style="margin-top: 1rem;">
                    <a href="{{ url_for('create_plan') }}" class="btn btn-small">Create Your First Plan</a>
                </div>
                {% endif %}
            </div>

            <div class="card">
                <h3>Progress</h3>
                <p>Track your learning journey here.</p>
            </div>
        </div>

        <div class="ml-notice">
            <p><em>Coming Soon: AI-driven study recommendations based on your learning pace!</em></p>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 Study Planner. All rights reserved.</p>
    </footer>
</body>

</html>